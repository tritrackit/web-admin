<mat-toolbar color="#fff" class="mat-elevation-z4">
  <button [disabled]="isProcessing" style="margin-right: 10px!important;" mat-icon-button
    matTooltip="Cancel"
    routerLink="/cbu">
    <mat-icon>close</mat-icon>
  </button>
  <span id="title">
    <span [ngStyle.md]="{ 'display': 'none'}" [ngStyle.sm]="{ 'display': 'none'}" [ngStyle.xs]="{ 'display': 'none'}">
      Register New CBU
    </span>
  </span>
  <span class="toolbar-item-spacer"></span>
  <div class="toolbar-action">
    <button mat-raised-button color="primary" matTooltip="Register"
      [disabled]="!formIsReady || !formIsValid || isProcessing" form="unitForm" type="submit">
      Register
    </button>
  </div>
</mat-toolbar>
<div class="content">
  <div class="inner-content">
    <h4 class="inner-content-title">CBU Registration</h4>
    <mat-card>
      <mat-card-content>
        <div fxLayout="column" fxLayoutGap="16px">
          <div fxFlex="100" class="content-inner" fxLayout="column">
            <form [formGroup]="unitForm" fxLayout="row wrap" id="unitForm" (ngSubmit)="onSubmit()">
              <fieldset fxFlex="100" fxLayout="row wrap" style="row-gap: 16px">
                <!-- RFID and Location (Readonly) -->
                <div fxLayout="column" fxLayout.gt-sm="row" fxFlex="100" class="content-inner" fxLayoutGap="16px">
                  <mat-form-field appearance="outline" fxFlex.gt-sm="50%" fxFlex="100" class="cell"
                    [ngClass.gt-sm]="{ isLargeScreen: true }">
                    <mat-label>Location</mat-label>
                    <input readonly matInput [value]="location?.name || 'Waiting for RFID scan...'"/>
                  </mat-form-field>

                  <mat-form-field appearance="outline" fxFlex.gt-sm="50%" fxFlex="100" class="cell"
                    [ngClass.gt-sm]="{ isLargeScreen: true }">
                    <mat-label>RFID</mat-label>
                    <input readonly matInput placeholder="Scan RFID to register" formControlName="rfid" />
                    <mat-error *ngIf="getError('rfid')">{{
                      (getError("rfid") &&
                      getError("rfid")["required"]
                      ? "Please scan RFID"
                      : "") ||
                      (getError("rfid") &&
                      getError("rfid")["exist"]
                      ? "RFID already exists"
                      : "")
                      }}</mat-error>
                  </mat-form-field>
                </div>

                <!-- Model and Chassis No (Always visible - ready for input) -->
                <div fxLayout="column" fxLayout.gt-sm="row" fxFlex="100" class="content-inner"
                  fxLayoutGap="16px">
                  <mat-form-field class="example-full-width" appearance="outline" fxFlex.gt-sm="50%" fxFlex="100"
                    style="position: relative!important;">
                    <mat-label>Model</mat-label>
                    <input type="text" placeholder="Select model" aria-label="Select model" matInput
                      [formControl]="modelSearchCtrl" [matAutocomplete]="autoModel"
                      (focusout)="mapSearchModel();" #modelSearchInput (input)="isOptionsModelLoading = true;" 
                      #modelTrig="matAutocompleteTrigger" matAutocompleteTrigger>
                    <mat-autocomplete #autocompleteModel #autoModel="matAutocomplete"
                      [displayWith]="displayModelName"
                      (optionSelected)="onModelSelected($event.option.value)">
                      <mat-option *ngFor="let option of optionsModel" [value]="option.code">
                        {{option.name}}
                      </mat-option>
                    </mat-autocomplete>
                    <mat-error *ngIf="getError('modelId') || modelSearchCtrl.errors">
                      {{
                      (getError("modelId") && getError("modelId").required
                      ? "Please select model"
                      : "") ||
                      (modelSearchCtrl.errors && modelSearchCtrl.errors.required
                      ? "Please select model"
                      : "")
                      }}
                    </mat-error>
                    <mat-spinner *ngIf="isOptionsModelLoading"></mat-spinner>
                  </mat-form-field>
                  <mat-form-field appearance="outline" fxFlex.gt-sm="50%" fxFlex="100" class="cell"
                    [ngClass.gt-sm]="{ isLargeScreen: true }">
                    <mat-label>Chassis no</mat-label>
                    <input matInput placeholder="Enter chassis number" formControlName="chassisNo" />
                    <mat-error *ngIf="getError('chassisNo')">{{
                      (getError("chassisNo") &&
                      getError("chassisNo")["required"]
                      ? "Please enter chassis no"
                      : "")
                      }}</mat-error>
                  </mat-form-field>
                </div>

                <!-- Color (Always visible) -->
                <div fxFlex="100" fxLayout="column" fxLayout.gt-sm="row" style="gap: 16px">
                  <mat-form-field appearance="outline" fxFlex.gt-sm="100%" fxFlex="100" class="cell"
                    [ngClass.gt-sm]="{ isLargeScreen: true }">
                    <mat-label>Color</mat-label>
                    <mat-select formControlName="color" placeholder="Select color">
                      <mat-option *ngFor="let color of availableColors" [value]="color">
                        {{ color }}
                      </mat-option>
                    </mat-select>
                    <mat-error *ngIf="getError('color')">{{
                      (getError("color") &&
                      getError("color")["required"]
                      ? "Please select color"
                      : "")
                      }}</mat-error>
                  </mat-form-field>
                </div>

                <!-- Description (Always visible) -->
                <div fxFlex="100" fxLayout="column" fxLayout.gt-sm="row" style="gap: 16px">
                  <mat-form-field appearance="outline" fxFlex.gt-sm="100%" fxFlex="100" class="cell"
                    [ngClass.gt-sm]="{ isLargeScreen: true }">
                    <mat-label>Description</mat-label>
                    <textarea matInput placeholder="Enter description" formControlName="description"></textarea>
                    <mat-error *ngIf="getError('description')">{{
                      (getError("description") &&
                      getError("description")["required"]
                      ? "Please enter description"
                      : "")
                      }}</mat-error>
                  </mat-form-field>
                </div>
              </fieldset>
            </form>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>

